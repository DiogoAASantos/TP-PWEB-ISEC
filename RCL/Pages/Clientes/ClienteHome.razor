@page "/hcliente"
@using RCL.Data.DTO
@using RCL.Data.Model
@using RCL.Data.Interfaces

@inject ICategoriaService CategoriaService
@inject IProdutoService ProdutoService
@inject IJSRuntime JS

<div class="home-container">

    <div class="categories-section">
        <button class="scroll-btn left" @onclick='() => ScrollCategorias("left")'>
            <i class="bi bi-chevron-left"></i>
        </button>

        <div class="categories-wrapper" id="catScroll">
            <div class="category-card" @onclick="CarregarTodosProdutos">
                <div class="cat-info" style="background-color: #008ba3;">
                    <span class="cat-name">Todos</span>
                </div>
            </div>

            @foreach (var cat in categorias)
            {
                <div class="category-card" @onclick="() => FiltrarPorCategoria(cat.Id)">

                    @if (!string.IsNullOrEmpty(cat.ImagemUrl))
                    {
                        <img src="@($"https://72qc49t4-7000.uks1.devtunnels.ms{cat.ImagemUrl}")"
                             alt="@cat.Nome"
                             class="cat-img" />
                    }
                    else
                    {
                        <div class="placeholder-img">
                            <i class="bi bi-image"></i>
                        </div>
                    }

                    <div class="cat-info" style="@(categoriaSelecionada == cat.Id ? "background-color: #FFEB3B; color: black; font-weight:bold;" : "")">
                        <span class="cat-name">@cat.Nome</span>
                    </div>
                </div>
            }
        </div>

        <button class="scroll-btn right" @onclick='() => ScrollCategorias("right")'>
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>

    <div class="content p-4">
        <h3>@tituloSecao</h3>

        <ProdutoGrid Produtos="produtosExibidos" />

    </div>

</div>

@code {
    private List<CategoriaDTO> categorias = new();
    private List<Produto>? produtosExibidos;
    private int categoriaSelecionada = 0; 
    private string tituloSecao = "Sugestões da Semana";

    protected override async Task OnInitializedAsync()
    {
        categorias = await CategoriaService.ObterCategoriasAsync();

        await CarregarTodosProdutos();
    }

    private async Task CarregarTodosProdutos()
    {
        categoriaSelecionada = 0;
        tituloSecao = "Todos os Produtos";
        produtosExibidos = null;
        produtosExibidos = await ProdutoService.ListarProdutosAsync();
    }

    private async Task FiltrarPorCategoria(int categoriaId)
    {
        categoriaSelecionada = categoriaId;
        var catNome = categorias.FirstOrDefault(c => c.Id == categoriaId)?.Nome;
        tituloSecao = $"Categoria: {catNome}";

        produtosExibidos = null;

        produtosExibidos = await ProdutoService.ListarProdutosPorCategoriaAsync(categoriaId);
    }

    private async Task ScrollCategorias(string direction)
    {
        await JS.InvokeVoidAsync("scrollElemento", "catScroll", direction);
    }
}